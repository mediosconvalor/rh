<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Empleado</title>
</head>
<body>
  <h2>Bienvenido, <span id="nombreEmpleado"></span></h2>
  <p><strong>Correo:</strong> <span id="correoEmpleado"></span></p>
  <p><strong>Departamento:</strong> <span id="departamentoEmpleado"></span></p>
  
  <h3>Solicitar Vacaciones/Permiso</h3>
  <form id="formSolicitud" onsubmit="return enviarSolicitud()">
    <input type="text" id="motivo" placeholder="Motivo de la solicitud" required>
    <input type="date" id="fechaInicio" required>
    <input type="date" id="fechaFin" required>
    <button type="submit">Enviar solicitud</button>
  </form>

  <button onclick="cerrarSesion()">Cerrar sesión</button>

  <script>
    const empleado = JSON.parse(sessionStorage.getItem("empleado"));
    
    if (!empleado) {
      alert("Debes iniciar sesión.");
      window.location.href = "index.html";
    } else {
      document.getElementById("nombreEmpleado").innerText = empleado.nombre;
      document.getElementById("correoEmpleado").innerText = empleado.correo;
      document.getElementById("departamentoEmpleado").innerText = empleado.departamento;
    }

    function enviarSolicitud() {
      const motivo = document.getElementById("motivo").value;
      const fechaInicio = document.getElementById("fechaInicio").value;
      const fechaFin = document.getElementById("fechaFin").value;
      
      fetch(`https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxx/exec?action=solicitarPermiso&email=${empleado.correo}&motivo=${motivo}&fechaInicio=${fechaInicio}&fechaFin=${fechaFin}`)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert("Solicitud enviada correctamente.");
          } else {
            alert("Error al enviar solicitud.");
          }
        });

      return false;
    }

    function cerrarSesion() {
      sessionStorage.removeItem("empleado");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
